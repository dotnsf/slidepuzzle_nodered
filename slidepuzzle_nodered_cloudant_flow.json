[{"id":"1f911b88.a7701c","type":"template","z":"ae18d710.8f8348","name":"スライドパズル","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"\n<!DOCTYPE html>\n<html lang=\"ja\">\n\t<head>\n\t\t<meta charset=\"UTF-8\"/>\n\t\t<title>スライドパズル</title>\n\t\t<script type=\"text/javascript\" src=\"https://code.jquery.com/jquery-2.2.4.min.js\"></script>\n\t\t<link href=\"https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css\" rel=\"stylesheet\"/>\n\t\t<script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js\"></script>\n\t\t<link href=\"https://use.fontawesome.com/releases/v5.6.3/css/all.css\" rel=\"stylesheet\"/>\n\t\t<link rel=\"stylesheet\" type=\"text/css\" href=\"https://dotnsf-html.au-syd.mybluemix.net/jquery.jqpuzzle.css\"/>\n\t\t<script type=\"text/javascript\" src=\"https://dotnsf-html.au-syd.mybluemix.net/jquery.jqpuzzle.min.js\"></script>\n\t\t<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\"/>\n\n\t\t<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\"/>\n\t\t<meta name=\"apple-mobile-web-app-capable\" content=\"yes\"/>\n\t\t<meta name=\"apple-mobile-web-app-status-bar-style\" content=\"black\"/>\n\t\t<meta name=\"apple-mobile-web-app-title\" content=\"スライドパズル\"/>\n\n\t<script>\n\t\t$(function(){\n\t\t\t  var imagefile = document.getElementById( 'imagefile' );\n\t\t\t  imagefile.addEventListener( 'change', selectReadFile, false );\n\t\t});\n\nfunction selectReadFile( e ){\n\t  var file = e.target.files;\n\t  var reader = new FileReader();\n\t  reader.onload = function(){\n\t\t      readDrawImg( reader, 0, 0 );\n\t\t    };\n\t  reader.readAsDataURL( file[0] );\n}\n\nfunction readDrawImg( reader, x, y ){\n\t  var img = readImg( reader );\n\t  img.onload = function(){\n\t\t      var w = img.width;\n\t\t      var h = img.height;\n\t\t      $('#slidegame_img').prop( 'src', img.src );\n\t\t      $('#slidegame_img').prop( 'width', '600' );\n\t\t      //h = parseInt( 600 * h / w );\n\t\t      //$('#slidegame_img').prop( 'height', '' + h );\n\n\t\t      var t = $('img.jqPuzzle');\n\t\t      t.jqPuzzle( slide_settings, slide_texts );\n\t\t    };\n}\n\nfunction readImg( reader ){\n\t  var result_dataURL = reader.result;\n\t  var img = new Image();\n\t  img.src = result_dataURL;\n\n\t  return img;\n}\n\nfunction postScore( results ){\n    results.moves = parseInt( results.moves );\n    results.seconds = parseInt( results.seconds );\n    results.timestamp = ( new Date() ).getTime();\n    $.ajax({\n       type: 'POST',\n       url: '/score',\n       data: results,\n       success: function( mydata ){\n           mydata.moves = parseInt( mydata.moves );\n           mydata.seconds = parseInt( mydata.seconds );\n           $.ajax({\n               type: 'GET',\n               url: '/scores',\n               success: function( body ){\n                   //alert( JSON.stringify( body ) );\n                   var alldata = [];\n                   body.forEach( function( data ){\n                      data.moves = parseInt( data.moves );\n                      data.seconds = parseInt( data.seconds );\n                      data.datetime = timestamp2datetime( data.timestamp );\n                      alldata.push( data );\n                   });\n                   alldata.sort( sortBySeconds );\n                   \n                   var ranking = '';\n                   for( var i = 0; i < alldata.length && i < 5; i ++ ){\n                       var d = alldata[i];\n                       var line = '[' + ( i + 1 ) + ']: ' + d.seconds + ' sec.(' + d.moves + ' steps) : ' + d.datetime;\n                       if( mydata.moves == d.moves && mydata.seconds == d.seconds ){\n                           line += ' <-- *';\n                       }\n                       line += \"\\n\";\n                       ranking += line;\n                   }\n                   alert( ranking );\n               },\n               error: function(){\n                   alert( '1 移動回数: ' + results.moves + '回, かかった時間: ' + results.seconds + '秒' );\n               }\n           })\n       },\n       error: function(){\n           alert( '移動回数: ' + results.moves + '回, かかった時間: ' + results.seconds + '秒' );\n       }\n    });\n}\n\nfunction timestamp2datetime( ts ){\n    var dt = new Date();\n    \n    //var tz = dt.getTimezoneOffset() / 60;\n    //ts += ( tz + 9 ) * 60 * 60 * 1000;\n\n    dt.setTime( ts );\n    var y = dt.getFullYear();\n    var m = dt.getMonth() + 1;\n    var d = dt.getDate();\n    var h = dt.getHours();\n    var n = dt.getMinutes();\n    var s = dt.getSeconds();\n    \n    var s = y\n      + '/' + ( m < 10 ? '0' : '' ) + m\n      + '/' + ( d < 10 ? '0' : '' ) + d\n      + ' ' + ( h < 10 ? '0' : '' ) + h\n      + ':' + ( n < 10 ? '0' : '' ) + n\n      + ':' + ( s < 10 ? '0' : '' ) + s;\n    return s;\n}\n\nfunction sortBySeconds( a, b ){\n  var r = 0;\n  if( a.seconds < b.seconds ){ r = -1; }\n  else if( a.seconds > b.seconds ){ r = 1; }\n\n  return r;\n}\n\t</script>\n<style type=\"text/css\">\nhtml, body{\n\t  text-align: center;\n\t\t    background-color: #fafafa;\n\t\t\t      font-size: 20px;\n\t\t\t\t        color: #333;\n}\nlabel > input{\n\t  display:none;\n}\nlabel{\n\t  color: #aaa;\n\t\t    background-color: #006dd9;\n\t\t\t      padding: 10px;\n\t\t\t\t        border: double 4px #aaa;\n}\n#slidegame_img{\n\t  max-width: 100%;\n\t\t    height: auto;\n}\n</style>\n\t</head>\n\t<body>\n\n\t\t<div class=\"container center-block text-center\">\n\t\t\t  <label for=\"imagefile\">\n\t\t\t\t      <i class=\"fas fa-camera\"></i>\n\t\t\t\t          <input type=\"file\" id=\"imagefile\"/>\n\t\t\t\t\t    </label>\n\t\t\t\t\t      <br/>\n\t\t\t\t\t        <img id=\"slidegame_img\" class=\"jqPuzzle\" />\n\t\t</div>\n\n\t<script>\n\t\t//. jquery puzzle\n\t\tvar slide_settings = {\n\t\t\t  rows: 4,\n\t\t\t  cols: 4,\n\t\t\t  hole: 16,\n\t\t\t  shuffle: true,\n\t\t\t  numbers: true,\n\t\t\t  language: 'ja',\n\t\t\t  control: {\n\t\t\t\t      shufflePieces: false,\n\t\t\t\t      confirmShuffle: true,\n\t\t\t\t      toggleOriginal: true,\n\t\t\t\t      toggleNumbers: true,\n\t\t\t\t      counter: true,\n\t\t\t\t      timer: true,\n\t\t\t\t      pauseTimer: true\n\t\t\t\t    },\n\t\t\t  success: {\n\t\t\t\t      fadeOriginal: false,\n\t\t\t\t      callback: function( results ){\n\t\t\t\t\t            alert( '移動回数: ' + results.moves + '回, かかった時間: ' + results.seconds + '秒' );\n\t\t\t\t\t            postScore( results );\n\t\t\t\t\t          },\n\t\t\t\t      callbackTimeout: 1000\n\t\t\t\t    },\n\t\t\t  animation: {\n\t\t\t\t      shuffleRounds: 3,\n\t\t\t\t      shuffleSpeed: 800,\n\t\t\t\t      slidingSpeed: 200,\n\t\t\t\t      fadeOriginalSpeed: 600\n\t\t\t\t    },\n\t\t\t  style: {\n\t\t\t\t      gridSize: 2,\n\t\t\t\t      overlap: true,\n\t\t\t\t      backgroundOpacity: 0.1\n\t\t\t\t    }\n\t\t};\nvar slide_texts = {\n\t  shuffleLabel: 'シャッフル',\n\t  toggleOriginalLabel: '元画像',\n\t  toggleNumbersLabel: '数値表示／非表示',\n\t  confirmShuffleMessage: 'シャッフルしてよろしいですか？',\n\t  movesLabel: '回',\n\t  secondsLabel: '秒'\n};\n\t</script>\n\t</body>\n</html>\n","output":"str","x":320,"y":120,"wires":[["cb8a8483.1eb2b8"]]}]